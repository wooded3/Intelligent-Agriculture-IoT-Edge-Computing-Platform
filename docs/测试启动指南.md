# 测试启动指南

## 后端测试

### 前置条件
1. 确保已安装 Java 21
2. 确保已安装 Maven
3. 确保数据库已配置（测试会使用内存数据库或测试数据库）

### 运行所有测试
```bash
cd backend
mvn test
```

### 运行特定测试类
```bash
cd backend
mvn test -Dtest=DeviceServiceTest
mvn test -Dtest=DataServiceTest
mvn test -Dtest=AlertServiceTest
mvn test -Dtest=DeviceControllerTest
mvn test -Dtest=DataControllerTest
mvn test -Dtest=AlertControllerTest
```

### 运行特定测试方法
```bash
cd backend
mvn test -Dtest=DeviceServiceTest#testRegisterDevice_Success
```

### 查看测试报告
测试完成后，可以在 `backend/target/surefire-reports/` 目录查看测试报告。

---

## 前端测试

### 前置条件
1. 确保已安装 Node.js 18+
2. 确保已安装依赖：`npm install`

### 运行所有测试
```bash
cd frontend
npm test
```

### 运行测试（监听模式）
```bash
cd frontend
npm test
# 按 'a' 运行所有测试
# 按 'f' 只运行失败的测试
# 按 'q' 退出
```

### 运行测试并查看UI界面
```bash
cd frontend
npm run test:ui
```
这会在浏览器中打开测试UI界面，可以可视化查看测试结果。

### 运行测试并生成覆盖率报告
```bash
cd frontend
npm run test:coverage
```
覆盖率报告会显示在终端，也可以查看 `frontend/coverage/` 目录。

---

## 快速启动命令

### Windows PowerShell
```powershell
# 后端测试
cd backend; mvn test

# 前端测试
cd frontend; npm test
```

### Linux/Mac
```bash
# 后端测试
cd backend && mvn test

# 前端测试
cd frontend && npm test
```

---

## 常见问题

### Q1: 后端测试失败，提示数据库连接错误
**A:** 测试使用Mock对象，不需要真实数据库连接。如果仍有问题，检查 `application.yml` 配置。

### Q2: 前端测试提示找不到模块
**A:** 运行 `npm install` 安装依赖。

### Q3: 测试运行很慢
**A:** 
- 后端：使用 `mvn test -DskipTests=false` 只运行测试，不打包
- 前端：使用 `npm test -- --run` 运行一次后退出（非监听模式）

### Q4: 如何只运行失败的测试
**A:**
- 后端：Maven会自动重试失败的测试
- 前端：在监听模式下按 `f` 键

---

## 测试文件位置

### 后端测试文件
- `backend/src/test/java/com/iaiotecp/backend/device/DeviceServiceTest.java`
- `backend/src/test/java/com/iaiotecp/backend/device/DeviceControllerTest.java`
- `backend/src/test/java/com/iaiotecp/backend/data/DataServiceTest.java`
- `backend/src/test/java/com/iaiotecp/backend/data/DataControllerTest.java`
- `backend/src/test/java/com/iaiotecp/backend/alert/AlertServiceTest.java`
- `backend/src/test/java/com/iaiotecp/backend/alert/AlertControllerTest.java`

### 前端测试文件
- `frontend/src/test/DeviceManagement.test.ts`

---

## 测试输出示例

### 后端测试成功输出
```
[INFO] Tests run: 8, Failures: 0, Errors: 0, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
```

### 前端测试成功输出
```
✓ src/test/DeviceManagement.test.ts (3)
  ✓ DeviceManagement.vue (3)
    ✓ 应该正确渲染设备管理页面
    ✓ 应该能够加载设备列表
    ✓ 应该能够处理设备创建

Test Files  1 passed (1)
     Tests  3 passed (3)
```



